{% load static %}
<nav class="navbar bg-base-200 shadow-lg" role="navigation" aria-label="Main navigation">

    <div class="navbar-start flex items-center">
        <div class="flex-none dropdown dropdown-start lg:hidden">
            <summary class="btn btn-ghost btn-sm" tabindex="0" role="button" aria-label="Main menu" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="mobile-menu-icon">
                    <title id="mobile-menu-icon">Menu</title>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </summary>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-2 z-50 p-2 shadow-lg bg-base-100 border-2 border-base-200">
                <li><a href="{% url 'trophies_list' %}">Trophies</a></li>
                <li><a href="{% url 'games_list' %}">Games</a></li>
                <li><a href="{% url 'profiles_list' %}">Profiles</a></li>
                <li>
                    <details>
                        <summary>Badges</summary>
                        <ul class="p-2 z-60 border-2 border-base-200">
                            <li><a href="{% url 'badges_list' %}">Badge List</a></li>
                            <li><a href="{% url 'milestones_list' %}">Milestones</a></li>
                            <li><a href="{% url 'overall_badge_leaderboards' %}">Leaderboards</a></li>
                        </ul>
                    </details>
                </li>
                <li>
                    <a>Community</a>
                    <ul class="p-2">
                        <li><a href="https://discord.gg/platpursuit" target="_blank" rel="noopener noreferrer">Discord</a></li>
                    </ul>
                </li>
                <li>
                    <a href="{% url 'guides_list' %}" aria-label="PPTV Guides">
                        <span class="flex flex-row gap-2 justify-end">
                            PPTV
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="var(--color-error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="pptv-icon-mobile">
                                <title id="pptv-icon-mobile">Video</title>
                                <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
                                <polyline points="17 2 12 7 7 2"></polyline>
                            </svg>
                        </span>
                    </a>
                </li>
            </ul>
        </div>
        <a href="/" class="btn btn-ghost items-center text-xl font-logo hidden sm:flex" aria-label="Platinum Pursuit Home">
            <img src="{% static 'images/logo.png' %}" alt="Platinum Pursuit Logo" class="h-8 w-8 mr-2 rounded-full" loading="eager" decoding="async" />
            Platinum Pursuit
        </a>
    </div>

    <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
            <li><a href="{% url 'trophies_list' %}">Trophies</a></li>
            <li><a href="{% url 'games_list' %}">Games</a></li>
            <li><a href="{% url 'profiles_list' %}">Profiles</a></li>
            <li>
                <details>
                    <summary>Badges</summary>
                    <ul class="p-2 z-60 border-2 border-base-200">
                        <li><a href="{% url 'badges_list' %}">Badge List</a></li>
                        <li><a href="{% url 'milestones_list' %}">Milestones</a></li>
                        <li><a href="{% url 'overall_badge_leaderboards' %}">Leaderboards</a></li>
                    </ul>
                </details>
            </li>
            <li>
                <details>
                    <summary><a>Community</a></summary>
                    <ul class="p-2 z-60 border-2 border-base-200">
                        <li><a href="https://discord.gg/platpursuit" target="_blank" rel="noopener noreferrer">Discord</a></li>
                    </ul>
                </details>
            </li>
            <li>
                <a href="{% url 'guides_list' %}" aria-label="PPTV Guides">
                    <span class="flex flex-row gap-2 justify-end">
                        PPTV
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="var(--color-error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="pptv-icon-desktop">
                            <title id="pptv-icon-desktop">Video</title>
                            <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
                            <polyline points="17 2 12 7 7 2"></polyline>
                        </svg>
                    </span>
                </a>
            </li>
        </ul>
    </div>

    <div class="navbar-center flex sm:hidden">
        <a href="/" class="btn btn-ghost flex items-center text-lg font-logo" aria-label="Platinum Pursuit Home">
            <img src="{% static 'images/logo.png' %}" alt="Platinum Pursuit Logo" class="h-8 w-8 mr-2 rounded-full" loading="eager" decoding="async" />
            Plat Pursuit
        </a>
    </div>

    <div class="navbar-end flex items-center gap-0 sm:gap-2 sm:mr-2">
        <button id="theme-toggle" class="hidden sm:flex btn btn-ghost btn-sm btn-circle" aria-label="Toggle theme">
            <!-- Sun icon (shown in dark mode - click to switch to light) -->
            <svg id="theme-icon-sun" class="w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <title>Switch to light mode</title>
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
            <!-- Moon icon (shown in light mode - click to switch to dark) -->
            <svg id="theme-icon-moon" class="w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <title>Switch to dark mode</title>
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        </button>

        {% if user.is_authenticated %}
        <!-- Notification Bell -->
        <div class="dropdown dropdown-end" id="notification-dropdown">
            <button
                tabindex="0"
                class="btn btn-ghost btn-sm btn-circle relative"
                aria-label="Notifications"
                aria-haspopup="true"
                aria-expanded="false">
                <!-- Bell SVG icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <title>Notifications</title>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                <!-- Unread badge -->
                <span id="notification-badge" class="absolute top-0 right-0 badge badge-error badge-sm hidden" aria-live="polite">0</span>
            </button>

            <div tabindex="0" class="dropdown-content z-[100] card card-compact w-80 sm:w-96 p-4 shadow-2xl bg-base-200 mt-3 border-2 border-base-300">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-bold text-lg">Notifications</h3>
                    <button id="mark-all-read-btn" class="btn btn-xs btn-ghost" aria-label="Mark all as read">Mark all read</button>
                </div>

                <!-- Notification list -->
                <div id="notification-list" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- Loading state -->
                    <div id="notification-loading" class="flex justify-center p-4">
                        <span class="loading loading-spinner loading-md"></span>
                    </div>

                    <!-- Empty state -->
                    <div id="notification-empty" class="text-center p-4 hidden">
                        <p class="text-base-content/60">No notifications yet</p>
                    </div>
                </div>

                <a href="{% url 'notification_inbox' %}" class="btn btn-primary btn-sm mt-3 w-full">View All</a>
            </div>
        </div>
        {% endif %}

        <form action="{% url 'search' %}" method="GET" class="join hidden">
            <select name="type" class="select select-sm select-primary join-item">
                <option value="game">Game</option>
                <option value="trophy">Trophy</option>
                <option value="user">Profile</option>
            </select>
            <input type="text" name="query" placeholder="Search..." class="input input-primary input-sm join-item w-32 lg:w-32 xl:w-48" />
            <button type="submit" class="btn btn-sm btn-primary join-item">Go</button>
        </form>

        <div class="dropdown dropdown-end hidden sm:block">
            <div tabindex="0" role="button" class="btn btn-ghost btn-sm btn-circle" aria-label="Search" aria-haspopup="true" aria-expanded="false">
                <div class="w-15 rounded-full flex">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="search-icon">
                        <title id="search-icon">Search</title>
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
            </div>
            <div class="dropdown-content mt-2 z-50 p-2 shadow-lg bg-base-100 border-2 border-base-200">
                <form action="{% url 'search' %}" method="GET" class="join">
                    <select name="type" class="select select-sm select-primary join-item w-auto">
                        <option value="game">Game</option>
                        <option value="trophy">Trophy</option>
                        <option value="user">Profile</option>
                    </select>
                    <input type="text" name="query" placeholder="Search..." class="input input-primary input-sm join-item w-32" />
                    <button type="submit" class="btn btn-sm btn-primary join-item">Go</button>
                </form>
            </div>
        </div>


        {% if user.is_authenticated %}
            <div class="dropdown dropdown-end">
                <div class="indicator">
                    {% if not user.profile or not user.premium_tier %}
                        <span class="indicator-item border-2 border-base-300 rounded-full w-3 h-3 bg-error animate-pulse" aria-label="Attention required"></span>
                    {% endif %}
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar" aria-label="User menu" aria-haspopup="true" aria-expanded="false">
                        <div class="w-15 rounded-full ring-2 ring-primary">
                            {% if user.profile %}
                                <img alt="Profile Picture" src="{{ user.profile.avatar_url }}" loading="lazy" decoding="async" />
                            {% else %}
                                <svg class="mx-auto my-1" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="default-avatar-icon">
                                    <title id="default-avatar-icon">User avatar</title>
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <ul tabindex="0" class="menu menu-sm dropdown-content mt-2 z-50 p-2 shadow-lg bg-base-100 border-2 border-base-200 min-w-40 w-fit">
                    {% if user.profile %}
                        {% if not user.premium_tier %}
                            <div class="indicator">
                                <span class="indicator-item indicator-middle border-2 border-base-300 rounded-full w-3 h-3 bg-error animate-pulse"></span>
                                <li><a href="{% url 'subscribe' %}">PP Premium</a></li>
                            </div>
                        {% else %}
                            <li><a href="{% url 'subscription_management' %}">My Premium</a></li>
                        {% endif %}
                        <li><a href="{% url 'my_checklists' %}">My Guides</a></li>
                        <li><a href="{% url 'my_shareables' %}">My Shareables</a></li>
                        <li><a href="{% url 'profile_detail' user.profile.psn_username %}">Profile</a></li>
                        <li><a href="{% url 'trophy_case' user.profile.psn_username %}">Trophy Case</a></li>
                    {% else %}
                        <div class="indicator">
                            <span class="indicator-item indicator-middle border-2 border-base-300 rounded-full w-3 h-3 bg-error animate-pulse"></span>
                            <li><a href="{% url 'link_psn' %}">Link PSN</a></li>
                        </div>
                    {% endif %}
                    {% if user.is_staff %}
                        <li>
                            <a href="{% url 'comment_moderation' %}" class="flex items-center">
                                <span>Moderation</span>
                                {% if pending_reports_count > 0 %}
                                    <span class="text-error">({{ pending_reports_count }})</span>
                                {% endif %}
                            </a>
                        </li>
                    {% endif %}
                    <li><a href="{% url 'settings' %}">Settings</a></li>
                    <li>
                        <form method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="w-full text-left">Logout</button>
                        </form>
                    </li>
                </ul>
            </div>
        {% else %}
            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar" aria-label="Login menu" aria-haspopup="true" aria-expanded="false">
                    <div class="w-15 rounded-full flex ring-2 ring-primary">
                        <svg class="mx-auto my-1" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="guest-avatar-icon">
                            <title id="guest-avatar-icon">Guest user</title>
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                </div>
                <ul tabindex="0" class="menu menu-sm dropdown-content mt-2 z-50 p-2 shadow-lg bg-base-100 border-2 border-base-200 w-fit">
                    <li><a href="{% url 'account_login' %}">Login</a></li>
                    <li><a href="{% url 'account_signup' %}">Register</a></li>
                </ul>
            </div>
        {% endif %}
    </div>
</nav>