{# Reusable challenge summary card for browse and history #}
{# Required context: challenge (Challenge instance with cover_image_url attached) #}

<a href="{% url 'az_challenge_detail' challenge_id=challenge.id %}" class="card bg-base-200 border-2 border-base-300 rounded-2xl shadow-lg shadow-neutral transition-all duration-300 hover:shadow-xl hover:border-primary hover:scale-[1.02] cursor-pointer group">

    {# Cover image - trading card style #}
    <div class="relative bg-gradient-to-b from-base-300 to-base-300/80 rounded-t-2xl p-4 pb-3">
        <figure class="aspect-square w-3/4 mx-auto rounded-xl overflow-hidden border-4 border-base-100/50 shadow-lg shadow-neutral ring-1 ring-base-content/10">
            {% if challenge.cover_image_url %}
                <img src="{{ challenge.cover_image_url }}"
                     alt="{{ challenge.name }}"
                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                     loading="lazy" />
            {% else %}
                {# A-Z grid placeholder when no cover image #}
                <div class="w-full h-full bg-gradient-to-br from-base-200 to-base-300 flex items-center justify-center p-3">
                    <div class="grid grid-cols-5 gap-1 w-full max-w-[140px]">
                        {% for slot in challenge.az_slots.all %}
                            <div class="aspect-square rounded flex items-center justify-center text-[0.55rem] font-bold
                                        {% if slot.is_completed %}bg-warning/30 text-warning{% elif slot.game %}bg-primary/20 text-primary{% else %}bg-base-300 text-base-content/20{% endif %}">
                                {{ slot.letter }}
                            </div>
                        {% empty %}
                            {# Fallback if slots not prefetched #}
                            <div class="col-span-5 flex items-center justify-center text-base-content/20">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5"/>
                                </svg>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </figure>

        {# Progress badge #}
        <div class="absolute top-2 right-2">
            <div class="badge badge-neutral shadow-lg font-bold gap-1">
                {{ challenge.completed_count }}/{{ challenge.total_items }}
            </div>
        </div>

        {# Complete badge #}
        {% if challenge.is_complete %}
            <div class="absolute top-2 left-2">
                <div class="badge badge-warning shadow-lg font-bold gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    Complete
                </div>
            </div>
        {% endif %}

        {# Deleted badge #}
        {% if challenge.is_deleted %}
            <div class="absolute top-2 left-2">
                <span class="badge badge-error badge-sm shadow-lg">Deleted</span>
            </div>
        {% endif %}
    </div>

    <div class="card-body p-4">
        {# Challenge name #}
        <h3 class="card-title text-base font-bold line-clamp-2 min-h-[3rem] group-hover:text-primary transition-colors duration-300">
            {{ challenge.name }}
        </h3>

        {# Author info #}
        <div class="flex items-center gap-2 text-sm text-base-content/60 mt-2">
            <div class="avatar">
                <div class="w-6 rounded-full ring-1 ring-base-300 group-hover:ring-primary transition-all duration-300">
                    {% if challenge.profile.avatar_url %}
                        <img src="{{ challenge.profile.avatar_url }}" alt="{{ challenge.profile.psn_username }}" loading="lazy" />
                    {% else %}
                        <div class="w-full h-full bg-base-300 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-base-content/30" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        </div>
                    {% endif %}
                </div>
            </div>
            <span class="truncate">
                by <span class="font-medium text-secondary">{{ challenge.profile.psn_username }}</span>
            </span>
        </div>

        {# Progress bar #}
        <div class="mt-3">
            <div class="flex justify-between text-xs text-base-content/60 mb-1">
                <span>{{ challenge.completed_count }}/{{ challenge.total_items }} Platinums</span>
                <span>{{ challenge.progress_percentage }}%</span>
            </div>
            <progress class="progress {% if challenge.is_complete %}progress-warning{% else %}progress-primary{% endif %} w-full h-2"
                      value="{{ challenge.completed_count }}"
                      max="{{ challenge.total_items }}"></progress>
        </div>

        {# Stats row #}
        <div class="flex items-center justify-between text-xs text-base-content/50 mt-3 pt-3 border-t border-base-300/50">
            <div class="flex items-center gap-3">
                <span class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    {{ challenge.view_count }}
                </span>
                <span>{{ challenge.filled_count }}/26 filled</span>
            </div>
            <span>{{ challenge.created_at|timesince }} ago</span>
        </div>
    </div>
</a>
