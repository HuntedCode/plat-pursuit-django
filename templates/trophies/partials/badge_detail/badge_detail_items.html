{% load custom_filters %}

    <a href="{% if profile %}{% url 'game_detail_with_profile' game.np_communication_id profile.psn_username %}{% else %}{% url 'game_detail' game.np_communication_id %}{% endif %}" class="card bg-base-100 border-4 border-base-300 shadow-md shadow-neutral cursor-pointer transition-all duration-300 hover:border-{{ game|platform_color }} hover:shadow-{{ game|platform_color }} group">
        <div class="{% if pgame.progress == 100 %}bg-success/15{% elif pgame.earned_trophies.platinum == 1 %}bg-warning/20{% else %}bg-base-100{% endif %}">
            <div class="card-body m-0 px-3 py-3 {% if pgame.progress == 100 %}border-4 border-success{% elif pgame.earned_trophies.platinum == 1 %}border-4 border-warning{% endif %}">
                <div class="flex flex-col lg:flex-row lg:justify-between items-center gap-4 w-full">
                    <div class="flex flex-col lg:flex-row items-center justify-start gap-2 col-span-1 w-full">
                        <figure class="border-4 border-base-300 rounded-box transition-all duration-300 w-28 mr-2 lg:mr-4 group-hover:border-{{ game|platform_color }} hover:scale-105">
                            {% if game.title_image and not game.force_title_icon %}
                                <img src="{{ game.title_image }}" alt="{{ game.title_name }}" class="w-full object-cover shrink-0" loading="lazy" />
                            {% else %}
                                <img src="{{ game.title_icon_url }}" alt="{{ game.title_name }}" class="w-full object-fill shrink-0" loading="lazy" />
                            {% endif %}
                        </figure>
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex flex-row gap-0 items-center justify-start">
                                {% if game.has_online_trophies %}
                                    <div class="tooltip w-fit" data-tip="Online Trophies Required">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 hover:scale-105" viewBox="0 0 24 24" fill="none" stroke="var(--color-warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                    </div>
                                    <div class="divider divider-horizontal m-0 p-0"></div>
                                {% endif %}
                                {% if ratings %}
                                    <span class="flex flex-row gap-1 items-center tooltip font-bold {% if ratings.avg_difficulty < 4 %}text-success{% elif ratings.avg_difficulty < 8 %}text-warning{% else %}text-error{% endif %} w-fit" data-tip="Avg. Difficulty">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hover:scale-105 pr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z"/></svg>                                
                                        {{ ratings.avg_difficulty }}
                                    </span>

                                    <div class="divider divider-horizontal m-0 p-0"></div>

                                    <span class="flex flex-row gap-1 items-center tooltip font-bold {% if ratings.avg_grindiness < 4 %}text-success{% elif ratings.avg_grindiness < 8 %}text-warning{% else %}text-error{% endif %} w-fit" data-tip="Avg. Grindiness">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 hover:scale-105 pr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M2.5 2v6h6M21.5 22v-6h-6"/><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"/></svg>
                                        {{ ratings.avg_grindiness }}
                                    </span>

                                    <div class="divider divider-horizontal m-0 p-0"></div>

                                    <span class="flex flex-row gap-1 items-center tooltip font-bold {% if ratings.avg_hours < 25 %}text-success{% elif ratings.avg_hours < 75 %}text-warning{% elif ratings.avg_hours < 100 %}text-accent{% else %}text-error{% endif %} w-fit" data-tip="Avg. Hours To Plat">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 hover:scale-105 pr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                        {{ ratings.avg_hours }}
                                    </span>

                                    <div class="divider divider-horizontal m-0 p-0"></div>

                                    <span class="flex flex-row gap-1 items-center tooltip font-bold w-fit" data-tip="Total Ratings">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hover:scale-105 pr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        {{ ratings.count }}
                                    </span>
                                {% else %}
                                    <p class="text-base-content/70 text-sm pr-1 italic">No ratings yet. Be the first!</p>
                                {% endif %}
                            </div>
                            <h1 class="text-lg 2xl:text-2xl text-base-content italic pr-1 line-clamp-2">{{ game.title_name }}</h1>
                            <div class="flex flex-row items-center gap-2">
                                {% for platform in game.title_platform reversed %}
                                    <div class="badge badge-xs lg:badge-sm badge-ghost font-bold text-xs md:text-sm lg:text-base border-2 border-{{ platform|platform_color_str }} rounded-box hover:scale-105">{{ platform }}</div>
                                {% endfor %}
                                {% if game.is_regional %}
                                    <div class="flex flex-row gap-2">
                                        {% for region in game.region %}
                                            {% if region == "NA" %}
                                                <div class="badge badge-xs lg:badge-sm badge-primary font-bold italic hover:scale-105">NA</div>
                                            {% elif region == "EU" %}
                                                <div class="badge badge-xs lg:badge-sm badge-secondary font-bold italic hover:scale-105">EU</div>
                                            {% elif region == "JP" %}
                                                <div class="badge badge-xs lg:badge-sm badge-accent font-bold italic hover:scale-105">JP</div>
                                            {% else %}
                                                <div class="badge badge-xs lg:badge-sm badge-warning font-bold italic hover:scale-105">AS</div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="badge badge-sm badge-ghost font-bold italic hover:scale-105">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"  viewBox="0 0 512 512" stroke="var(--color-success)" fill="var(--color-success)"><path d="M351.9 280l-190.9 0c2.9 64.5 17.2 123.9 37.5 167.4 11.4 24.5 23.7 41.8 35.1 52.4 11.2 10.5 18.9 12.2 22.9 12.2s11.7-1.7 22.9-12.2c11.4-10.6 23.7-28 35.1-52.4 20.3-43.5 34.6-102.9 37.5-167.4zM160.9 232l190.9 0C349 167.5 334.7 108.1 314.4 64.6 303 40.2 290.7 22.8 279.3 12.2 268.1 1.7 260.4 0 256.4 0s-11.7 1.7-22.9 12.2c-11.4 10.6-23.7 28-35.1 52.4-20.3 43.5-34.6 102.9-37.5 167.4zm-48 0C116.4 146.4 138.5 66.9 170.8 14.7 78.7 47.3 10.9 131.2 1.5 232l111.4 0zM1.5 280c9.4 100.8 77.2 184.7 169.3 217.3-32.3-52.2-54.4-131.7-57.9-217.3L1.5 280zm398.4 0c-3.5 85.6-25.6 165.1-57.9 217.3 92.1-32.7 159.9-116.5 169.3-217.3l-111.4 0zm111.4-48C501.9 131.2 434.1 47.3 342 14.7 374.3 66.9 396.4 146.4 399.9 232l111.4 0z"/></svg>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col w-full lg:w-auto lg:min-w-110 2xl:min-w-140">
                        <div class="flex flex-col sm:flex-row items-center justify-around w-full gap-2 sm:gap-0 mb-4">
                            <div class="flex flex-row items-center justify-around w-full gap-4">
                                <div class="flex flex-row items-end">
                                    <svg class="mr-4 w-7 2xl:w-10 h-7 2xl:h-10 hover:scale-105" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="var(--color-trophy-bronze)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><g> <path class="st0" d="M102.49,0c0,27.414,0,104.166,0,137.062c0,112.391,99.33,156.25,153.51,156.25 c54.18,0,153.51-43.859,153.51-156.25c0-32.896,0-109.648,0-137.062H102.49z M256.289,50.551l-68.164,29.768v98.474l-0.049,19.53 c-0.526-0.112-47.274-10.112-47.274-78.391c0-28.17,0-69.6,0-69.6h60.385L256.289,50.551z"></path> <polygon class="st0" points="315.473,400.717 291.681,367.482 279.791,318.506 256,322.004 232.209,318.506 220.314,367.482 205.347,388.394 196.527,400.476 196.699,400.476 196.527,400.717 "></polygon> <polygon class="st0" points="366.93,432.24 366.93,432 145.07,432 145.07,511.598 145.07,511.76 145.07,511.76 145.07,512 366.93,512 366.93,432.402 366.93,432.24 "></polygon> <path class="st0" d="M511.638,96.668c-0.033-1.268-0.068-2.336-0.068-3.174V45.1h-73.889v38.736h35.152v9.658 c0,1.127,0.037,2.557,0.086,4.258c0.389,13.976,1.303,46.707-21.545,70.203c-5.121,5.266-11.221,9.787-18.219,13.613 c-3.883,17.635-10.109,33.564-18.104,47.814c26.561-6.406,48.026-17.898,64.096-34.422 C513.402,159.734,512.121,113.918,511.638,96.668z"></path> <path class="st0" d="M60.625,167.955c-22.848-23.496-21.934-56.227-21.541-70.203c0.047-1.701,0.082-3.131,0.082-4.258v-9.658 h34.842h0.07l0,0h0.24V45.1H0.43v48.394c0,0.838-0.032,1.906-0.068,3.174c-0.482,17.25-1.76,63.066,32.494,98.293 c16.068,16.524,37.531,28.014,64.092,34.422c-7.996-14.25-14.22-30.182-18.103-47.816C71.846,177.74,65.746,173.221,60.625,167.955 z"></path> </g> </g></svg>
                                    <p class="text-sm 2xl:text-base font-bold"><span class="text-2xl 2xl:text-3xl text-primary">{{ pgame.earned_trophies.bronze|default:0 }}</span> / {{ game.defined_trophies.bronze }}</p>
                                </div>
                                <div class="flex flex-row items-end">
                                    <svg class="mr-4 w-7 2xl:w-10 h-7 2xl:h-10 hover:scale-105" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="var(--color-trophy-silver)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><g> <path class="st0" d="M102.49,0c0,27.414,0,104.166,0,137.062c0,112.391,99.33,156.25,153.51,156.25 c54.18,0,153.51-43.859,153.51-156.25c0-32.896,0-109.648,0-137.062H102.49z M256.289,50.551l-68.164,29.768v98.474l-0.049,19.53 c-0.526-0.112-47.274-10.112-47.274-78.391c0-28.17,0-69.6,0-69.6h60.385L256.289,50.551z"></path> <polygon class="st0" points="315.473,400.717 291.681,367.482 279.791,318.506 256,322.004 232.209,318.506 220.314,367.482 205.347,388.394 196.527,400.476 196.699,400.476 196.527,400.717 "></polygon> <polygon class="st0" points="366.93,432.24 366.93,432 145.07,432 145.07,511.598 145.07,511.76 145.07,511.76 145.07,512 366.93,512 366.93,432.402 366.93,432.24 "></polygon> <path class="st0" d="M511.638,96.668c-0.033-1.268-0.068-2.336-0.068-3.174V45.1h-73.889v38.736h35.152v9.658 c0,1.127,0.037,2.557,0.086,4.258c0.389,13.976,1.303,46.707-21.545,70.203c-5.121,5.266-11.221,9.787-18.219,13.613 c-3.883,17.635-10.109,33.564-18.104,47.814c26.561-6.406,48.026-17.898,64.096-34.422 C513.402,159.734,512.121,113.918,511.638,96.668z"></path> <path class="st0" d="M60.625,167.955c-22.848-23.496-21.934-56.227-21.541-70.203c0.047-1.701,0.082-3.131,0.082-4.258v-9.658 h34.842h0.07l0,0h0.24V45.1H0.43v48.394c0,0.838-0.032,1.906-0.068,3.174c-0.482,17.25-1.76,63.066,32.494,98.293 c16.068,16.524,37.531,28.014,64.092,34.422c-7.996-14.25-14.22-30.182-18.103-47.816C71.846,177.74,65.746,173.221,60.625,167.955 z"></path> </g> </g></svg>
                                    <p class="text-sm 2xl:text-base font-bold"><span class="text-2xl 2xl:text-3xl text-primary">{{ pgame.earned_trophies.silver|default:0 }}</span> / {{ game.defined_trophies.silver }}</p>
                                </div>
                            </div>
                            <div class="flex flex-row items-center justify-around w-full gap-4">
                                <div class="flex flex-row items-end">
                                    <svg class="mr-4 w-7 2xl:w-10 h-7 2xl:h-10 hover:scale-105" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="var(--color-trophy-gold)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><g> <path class="st0" d="M102.49,0c0,27.414,0,104.166,0,137.062c0,112.391,99.33,156.25,153.51,156.25 c54.18,0,153.51-43.859,153.51-156.25c0-32.896,0-109.648,0-137.062H102.49z M256.289,50.551l-68.164,29.768v98.474l-0.049,19.53 c-0.526-0.112-47.274-10.112-47.274-78.391c0-28.17,0-69.6,0-69.6h60.385L256.289,50.551z"></path> <polygon class="st0" points="315.473,400.717 291.681,367.482 279.791,318.506 256,322.004 232.209,318.506 220.314,367.482 205.347,388.394 196.527,400.476 196.699,400.476 196.527,400.717 "></polygon> <polygon class="st0" points="366.93,432.24 366.93,432 145.07,432 145.07,511.598 145.07,511.76 145.07,511.76 145.07,512 366.93,512 366.93,432.402 366.93,432.24 "></polygon> <path class="st0" d="M511.638,96.668c-0.033-1.268-0.068-2.336-0.068-3.174V45.1h-73.889v38.736h35.152v9.658 c0,1.127,0.037,2.557,0.086,4.258c0.389,13.976,1.303,46.707-21.545,70.203c-5.121,5.266-11.221,9.787-18.219,13.613 c-3.883,17.635-10.109,33.564-18.104,47.814c26.561-6.406,48.026-17.898,64.096-34.422 C513.402,159.734,512.121,113.918,511.638,96.668z"></path> <path class="st0" d="M60.625,167.955c-22.848-23.496-21.934-56.227-21.541-70.203c0.047-1.701,0.082-3.131,0.082-4.258v-9.658 h34.842h0.07l0,0h0.24V45.1H0.43v48.394c0,0.838-0.032,1.906-0.068,3.174c-0.482,17.25-1.76,63.066,32.494,98.293 c16.068,16.524,37.531,28.014,64.092,34.422c-7.996-14.25-14.22-30.182-18.103-47.816C71.846,177.74,65.746,173.221,60.625,167.955 z"></path> </g> </g></svg>
                                    <p class="text-sm 2xl:text-base font-bold"><span class="text-2xl 2xl:text-3xl text-primary">{{ pgame.earned_trophies.gold|default:0 }}</span> / {{ game.defined_trophies.gold }}</p>
                                </div>
                                <div class="flex flex-row items-end">
                                    <svg class="mr-4 w-7 2xl:w-10 h-7 2xl:h-10 hover:scale-105" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="var(--color-trophy-platinum)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><g> <path class="st0" d="M102.49,0c0,27.414,0,104.166,0,137.062c0,112.391,99.33,156.25,153.51,156.25 c54.18,0,153.51-43.859,153.51-156.25c0-32.896,0-109.648,0-137.062H102.49z M256.289,50.551l-68.164,29.768v98.474l-0.049,19.53 c-0.526-0.112-47.274-10.112-47.274-78.391c0-28.17,0-69.6,0-69.6h60.385L256.289,50.551z"></path> <polygon class="st0" points="315.473,400.717 291.681,367.482 279.791,318.506 256,322.004 232.209,318.506 220.314,367.482 205.347,388.394 196.527,400.476 196.699,400.476 196.527,400.717 "></polygon> <polygon class="st0" points="366.93,432.24 366.93,432 145.07,432 145.07,511.598 145.07,511.76 145.07,511.76 145.07,512 366.93,512 366.93,432.402 366.93,432.24 "></polygon> <path class="st0" d="M511.638,96.668c-0.033-1.268-0.068-2.336-0.068-3.174V45.1h-73.889v38.736h35.152v9.658 c0,1.127,0.037,2.557,0.086,4.258c0.389,13.976,1.303,46.707-21.545,70.203c-5.121,5.266-11.221,9.787-18.219,13.613 c-3.883,17.635-10.109,33.564-18.104,47.814c26.561-6.406,48.026-17.898,64.096-34.422 C513.402,159.734,512.121,113.918,511.638,96.668z"></path> <path class="st0" d="M60.625,167.955c-22.848-23.496-21.934-56.227-21.541-70.203c0.047-1.701,0.082-3.131,0.082-4.258v-9.658 h34.842h0.07l0,0h0.24V45.1H0.43v48.394c0,0.838-0.032,1.906-0.068,3.174c-0.482,17.25-1.76,63.066,32.494,98.293 c16.068,16.524,37.531,28.014,64.092,34.422c-7.996-14.25-14.22-30.182-18.103-47.816C71.846,177.74,65.746,173.221,60.625,167.955 z"></path> </g> </g></svg>
                                    <p class="text-sm 2xl:text-base font-bold"><span class="text-2xl 2xl:text-3xl text-primary">{{ pgame.earned_trophies.platinum|default:0 }}</span> / {{ game.defined_trophies.platinum }}</p>
                                </div>
                            </div>
                        </div>
                        <progress class="progress {% if pgame.progress < 33 %}progress-error{% elif pgame.progress < 66 %}progress-warning{% elif pgame.progress < 100 %}progress-success{% else %}progress-primary{% endif %} w-7/8 mx-auto mb-1" value="{{ pgame.progress }}" max="100"></progress>
                        <h3 class="text-base 2xl:text-lg text-base-content/70 text-center font-bold pr-1 italic">Total Completion: {{ pgame.progress|default:0 }}%</h3>
                    </div>
                </div>
            </div>
        </div>
    </a>