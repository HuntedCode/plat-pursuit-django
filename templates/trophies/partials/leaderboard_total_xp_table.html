{% load static custom_filters query_tags humanize %}
<div class="flex flex-col justify-start gap-2">
    <div class="flex items-center gap-2">
        <h2 class="text-lg italic font-bold">XP Leaderboard</h2>
        <div class="tooltip tooltip-right" data-tip="Updated: {{ lb_total_xp_refresh_time|iso_datetime }} Â· Refreshes every 6h">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-base-content/50 cursor-help" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        </div>
    </div>

    {% if lb_total_xp_page_obj.object_list %}
        {% include 'partials/leaderboard_pagination.html' with page_obj=lb_total_xp_page_obj paginator=lb_total_xp_paginator page_param='lb_total_xp_page' user_page=lb_total_xp_user_page user_rank=lb_total_xp_user_rank rank_prefix='1' %}

        <div class="w-full overflow-x-auto">
            <table class="table table-zebra bg-base-100/80 border-4 border-base-300 shadow-lg shadow-neutral rounded-box w-full">
                <thead>
                    <tr class="bg-base-200/50 border-b-2 border-base-300">
                        <th class="text-xs text-base-content/50 italic font-bold uppercase tracking-wide w-12"></th>
                        <th class="text-xs text-base-content/50 italic font-bold uppercase tracking-wide">User</th>
                        <th class="text-xs text-base-content/50 italic font-bold uppercase tracking-wide">Total XP</th>
                        <th class="text-xs text-base-content/50 italic font-bold uppercase tracking-wide">Total Badges</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in lb_total_xp_page_obj %}
                        <tr id="1-rank-{{ entry.rank }}" class="{% if request.user.is_authenticated and request.user.profile.display_psn_username == entry.psn_username %}bg-success/15{% endif %}{% if entry.rank == 1 %} border-l-6 border-warning bg-warning/5 shadow-sm shadow-warning/20{% elif entry.rank == 2 %} border-l-4 border-base-content/30 bg-base-content/5{% elif entry.rank == 3 %} border-l-4 border-accent bg-accent/5{% endif %} h-15 hover:bg-base-200/50 transition-colors duration-200">
                            <td class="text-center">
                                {% include 'trophies/partials/leaderboard_rank_cell.html' with rank=entry.rank %}
                            </td>
                            <td class="text-sm lg:text-base">
                                {% include 'trophies/partials/leaderboard_user_cell.html' with entry=entry %}
                            </td>
                            <td class="text-sm lg:text-base">
                                <div class="flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-secondary shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                                    </svg>
                                    <span>{{ entry.total_xp|intcomma }}</span>
                                </div>
                            </td>
                            <td class="text-sm lg:text-base">
                                <div class="flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-success shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    </svg>
                                    <span>{{ entry.total_badges|intcomma }}</span>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% include 'partials/leaderboard_pagination.html' with page_obj=lb_total_xp_page_obj paginator=lb_total_xp_paginator page_param='lb_total_xp_page' user_page=lb_total_xp_user_page user_rank=lb_total_xp_user_rank rank_prefix='1' %}
    {% else %}
        <div class="bg-base-100/50 rounded-box border-2 border-base-300 border-dashed text-center py-8 px-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto text-base-content/30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
            <p class="text-base-content/50 font-bold mt-3 italic pr-1">No XP earned across any series yet.</p>
            <p class="text-base-content/50 text-sm italic pr-1">The grind starts here.</p>
        </div>
    {% endif %}
</div>
