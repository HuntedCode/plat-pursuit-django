{% load custom_filters humanize static %}
{% for etrophy in trophy_log %}
{% with etrophy.trophy as trophy %}
    <a href="{% url 'game_detail_with_profile' trophy.game.np_communication_id profile.psn_username %}" class="card bg-base-100/80 border-2 border-base-300 shadow-sm shadow-neutral cursor-pointer transition-all duration-300 hover:border-{{ trophy|trophy_color }} hover:shadow-{{ trophy|trophy_color }} hover:shadow-md hover:z-10 group">
        <div class="card-body m-0 p-1.5 sm:p-2">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-2 lg:gap-3 w-full">
                <div class="flex flex-col lg:flex-row items-center justify-center lg:justify-start gap-2 w-full lg:w-auto">
                    <div class="flex flex-row items-center gap-2">
                        <figure class="border-2 border-{{ trophy.game|platform_color }} rounded-box transition-colors duration-300">
                            {% if trophy.game.title_image and not game.force_title_icon %}
                                <img src="{{ trophy.game.title_image }}" alt="{{ trophy.game.title_name }}" class="h-14 w-14 lg:h-16 lg:w-16 object-fill shrink-0" loading="lazy" />
                            {% else %}
                                <img src="{{ trophy.game.title_icon_url }}" alt="{{ trophy.game.title_name }}" class="h-14 w-14 lg:h-16 lg:w-16 object-cover shrink-0" loading="lazy" />
                            {% endif %}
                        </figure>
                        <figure class="border-2 border-{{ trophy|trophy_color }} rounded-box transition-colors duration-300">
                            <img src="{{ trophy.trophy_icon_url }}" alt="{{ trophy.trophy_name }}" class="h-14 w-14 lg:h-16 lg:w-16 object-fill shrink-0" loading="lazy" />
                        </figure>
                    </div>
                    <div class="flex flex-col items-center lg:items-start gap-0">
                        <h1 class="text-sm md:text-base lg:text-lg text-base-content font-semibold pr-1 line-clamp-2">{{ trophy.trophy_name }}</h1>
                        <h3 class="text-xs lg:text-sm text-base-content/70 pr-1 italic line-clamp-2">{{ trophy.trophy_detail }}</h3>
                        <h3 class="text-xs lg:text-sm text-accent italic pr-1 line-clamp-1">{{ trophy.game.title_name }}</h3>
                        <div class="flex flex-row items-center gap-2">
                            {% for platform in trophy.game.title_platform reversed %}
                                <div class="badge badge-xs badge-ghost font-bold text-xs border-2 border-{{ platform|platform_color_str }} rounded-box">{{ platform }}</div>
                            {% endfor %}
                            {% if trophy.game.is_regional %}
                                <div class="flex flex-row gap-2">
                                    {% for region in trophy.game.region %}
                                        {% if region == "NA" %}
                                            <div class="badge badge-xs badge-primary font-bold italic">NA</div>
                                        {% elif region == "EU" %}
                                            <div class="badge badge-xs badge-secondary font-bold italic">EU</div>
                                        {% elif region == "JP" %}
                                            <div class="badge badge-xs badge-accent font-bold italic">JP</div>
                                        {% else %}
                                            <div class="badge badge-xs badge-warning font-bold italic">AS</div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="badge badge-sm badge-ghost font-bold italic">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"  viewBox="0 0 512 512" stroke="var(--color-success)" fill="var(--color-success)"><path d="M351.9 280l-190.9 0c2.9 64.5 17.2 123.9 37.5 167.4 11.4 24.5 23.7 41.8 35.1 52.4 11.2 10.5 18.9 12.2 22.9 12.2s11.7-1.7 22.9-12.2c11.4-10.6 23.7-28 35.1-52.4 20.3-43.5 34.6-102.9 37.5-167.4zM160.9 232l190.9 0C349 167.5 334.7 108.1 314.4 64.6 303 40.2 290.7 22.8 279.3 12.2 268.1 1.7 260.4 0 256.4 0s-11.7 1.7-22.9 12.2c-11.4 10.6-23.7 28-35.1 52.4-20.3 43.5-34.6 102.9-37.5 167.4zm-48 0C116.4 146.4 138.5 66.9 170.8 14.7 78.7 47.3 10.9 131.2 1.5 232l111.4 0zM1.5 280c9.4 100.8 77.2 184.7 169.3 217.3-32.3-52.2-54.4-131.7-57.9-217.3L1.5 280zm398.4 0c-3.5 85.6-25.6 165.1-57.9 217.3 92.1-32.7 159.9-116.5 169.3-217.3l-111.4 0zm111.4-48C501.9 131.2 434.1 47.3 342 14.7 374.3 66.9 396.4 146.4 399.9 232l111.4 0z"/></svg>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="flex flex-row flex-wrap items-center justify-center lg:justify-end gap-1 w-full lg:w-auto">
                    <div class="flex flex-row items-center gap-1.5">
                        <img src="{% static 'images/logo.png' %}" class="w-5 lg:w-6 h-5 lg:h-6" />
                        <div class="flex flex-col items-center gap-0">
                            <span class="text-xs text-base-content/60 italic">PP</span>
                            <span class="text-xs lg:text-sm text-base-content font-semibold">{{ trophy.earn_rate|multiply:100|floatformat:2 }}%</span>
                        </div>
                    </div>
                    <div class="divider divider-horizontal mx-1"></div>
                    <div class="flex flex-row items-center gap-1.5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 lg:w-6 h-5 lg:h-6" fill="var(--color-base-content)" viewBox="0 0 16 16"><path d="M15.858 11.451c-.313.395-1.079.676-1.079.676l-5.696 2.046v-1.509l4.192-1.493c.476-.17.549-.412.162-.538-.386-.127-1.085-.09-1.56.08l-2.794.984v-1.566l.161-.054s.807-.286 1.942-.412c1.135-.125 2.525.017 3.616.43 1.23.39 1.368.962 1.056 1.356M9.625 8.883v-3.86c0-.453-.083-.87-.508-.988-.326-.105-.528.198-.528.65v9.664l-2.606-.827V2c1.108.206 2.722.692 3.59.985 2.207.757 2.955 1.7 2.955 3.825 0 2.071-1.278 2.856-2.903 2.072Zm-8.424 3.625C-.061 12.15-.271 11.41.304 10.984c.532-.394 1.436-.69 1.436-.69l3.737-1.33v1.515l-2.69.963c-.474.17-.547.411-.161.538.386.126 1.085.09 1.56-.08l1.29-.469v1.356l-.257.043a8.45 8.45 0 0 1-4.018-.323Z"/></svg>
                        <div class="flex flex-col items-center gap-0">
                            <span class="text-xs text-base-content/60 italic">PSN</span>
                            <span class="text-xs lg:text-sm text-base-content font-semibold">{{ trophy.trophy_earn_rate }}%</span>
                        </div>
                    </div>
                    <div class="divider divider-horizontal mx-1"></div>
                    <div class="bg-base-100 border-2 border-base-300 shadow-sm shadow-neutral w-8 h-8 group-hover:border-{{ trophy|trophy_color }} group-hover:shadow-{{ trophy|trophy_color }}">
                        {% include 'partials/icons/trophy_cup.html' with color=trophy|trophy_css_color size='w-full p-1.5' %}
                    </div>
                    <div class="divider divider-horizontal mx-1"></div>
                    <h3 class="text-xs lg:text-sm text-base-content/70 italic">{{ etrophy.earned_date_time|format_date:"with_tz" }}</h3>
                </div>
            </div>
        </div>
    </a>
{% endwith %}
{% empty %}
    <p>No trophies found. Try expanding your search!</p>
{% endfor %}
