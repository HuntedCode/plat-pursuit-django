{% extends 'base.html' %}
{% load static %}
{% block title %}Create Game List - Platinum Pursuit{% endblock %}

{% block content %}
<section class="shadow-lg shadow-neutral bg-base-200/80 rounded-box border-2 border-base-300 w-full p-0 lg:p-4">
    {% include 'partials/breadcrumb.html' with items=breadcrumb %}

    <div class="card bg-base-100 border-4 border-base-300 shadow-md shadow-neutral">
        <div class="card-body items-center text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M12 2 2 7l10 5 10-5-10-5Z"/><path d="m2 17 10 5 10-5"/><path d="m2 12 10 5 10-5"/>
            </svg>
            <h1 class="text-2xl lg:text-3xl font-bold mt-2">Create a New Game List</h1>
            <p class="text-base-content/70">Build your collection. Organize your hunt. Share your journey.</p>
            <p class="text-sm text-base-content/50 mt-1">
                {{ list_count }} list{{ list_count|pluralize }} created
                {% if not is_premium and max_lists %}
                    <span class="text-base-content/40">({{ max_lists }} max for free accounts)</span>
                {% endif %}
            </p>
        </div>
    </div>
</section>

<section class="shadow-lg shadow-neutral bg-base-200/80 rounded-box border-2 border-base-300 w-full p-0 lg:p-4 mt-6">
    <div class="max-w-xl mx-auto p-4">
        {# Form card #}
        <div class="card bg-base-100 border-2 border-base-300 shadow-md shadow-neutral">
            <div class="card-body">
                <form id="create-list-form">
                    <div class="form-control mb-4">
                        <label class="label" for="list-name-input">
                            <span class="label-text font-bold">List Name <span class="text-error">*</span></span>
                        </label>
                        <input type="text"
                               id="list-name-input"
                               class="input input-bordered w-full"
                               maxlength="200"
                               placeholder="e.g., My Backlog, Favorites, Best Platinums..."
                               required />
                        <div class="label">
                            <span class="label-text-alt text-base-content/50"><span id="name-counter">0</span>/200</span>
                        </div>
                    </div>

                    <div class="form-control mb-6">
                        <label class="label" for="list-desc-input">
                            <span class="label-text font-bold">Description</span>
                        </label>
                        <textarea id="list-desc-input"
                                  class="textarea textarea-bordered w-full h-20"
                                  maxlength="1000"
                                  placeholder="What's this list about? (optional)"></textarea>
                        <div class="label">
                            <span class="label-text-alt text-base-content/50"><span id="desc-counter">0</span>/1000</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        Create List
                    </button>
                </form>
            </div>
        </div>

        {# Quick-start suggestions #}
        <div class="text-center mt-6">
            <p class="text-sm text-base-content/50 mb-3">Or get started quickly:</p>
            <div class="flex flex-wrap justify-center gap-3">
                {% for name in suggested_lists %}
                    <button class="btn btn-outline btn-sm suggested-list-btn" data-name="{{ name }}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        {{ name }}
                    </button>
                {% endfor %}
            </div>
        </div>

        {# Premium upsell for free users #}
        {% if not is_premium %}
            <div class="mt-8 p-5 bg-gradient-to-r from-primary/10 via-secondary/5 to-primary/10 border-2 border-primary/20 rounded-box">
                <div class="flex flex-row items-center gap-4">
                    <div class="flex-shrink-0 text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                        </svg>
                    </div>
                    <div class="flex-1 text-left">
                        <h3 class="font-bold text-lg">Unlock the full list experience</h3>
                        <p class="text-xs text-base-content/50 mb-2">Premium takes your lists to the next level.</p>
                        <div class="flex flex-wrap gap-x-4 gap-y-1 text-sm text-base-content/70 justify-start">
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                                Unlimited lists
                            </span>
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                                Unlimited games per list
                            </span>
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                                Custom themes
                            </span>
                        </div>
                    </div>
                    <a href="{% url 'beta_access_required' %}" class="btn btn-primary whitespace-nowrap">
                        Upgrade to Premium
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block js_scripts %}
<script>PlatPursuit.ZoomScaler.init();</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('create-list-form');
        const nameInput = document.getElementById('list-name-input');
        const descInput = document.getElementById('list-desc-input');
        const nameCounter = document.getElementById('name-counter');
        const descCounter = document.getElementById('desc-counter');

        nameInput.addEventListener('input', () => nameCounter.textContent = nameInput.value.length);
        descInput.addEventListener('input', () => descCounter.textContent = descInput.value.length);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = nameInput.value.trim();
            if (!name) {
                PlatPursuit.ToastManager.error('Please enter a list name.');
                return;
            }
            try {
                const data = await PlatPursuit.API.post('/api/v1/lists/', {
                    name,
                    description: descInput.value.trim(),
                });
                if (data.success) {
                    PlatPursuit.ToastManager.success('List created!');
                    window.location.href = `/lists/${data.list.id}/edit/`;
                }
            } catch (err) {
                let msg = 'Failed to create list.';
                try { const errData = await err.response?.json(); msg = errData?.error || msg; } catch {}
                PlatPursuit.ToastManager.error(msg);
            }
        });

        // Quick-start suggested list buttons
        document.querySelectorAll('.suggested-list-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const name = btn.dataset.name;
                try {
                    const data = await PlatPursuit.API.post('/api/v1/lists/', { name });
                    if (data.success) {
                        PlatPursuit.ToastManager.success('List created!');
                        window.location.href = `/lists/${data.list.id}/edit/`;
                    }
                } catch (err) {
                    let msg = 'Failed to create list.';
                    try { const errData = await err.response?.json(); msg = errData?.error || msg; } catch {}
                    PlatPursuit.ToastManager.error(msg);
                }
            });
        });
    });
</script>
{% endblock %}
